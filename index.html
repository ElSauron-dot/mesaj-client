<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MesajlaÅŸma UygulamasÄ±</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="sidebar">
        <h2>Kanallar</h2>
        <button onclick="showTab('messages')">ðŸ’¬ Mesajlar</button>
        <button onclick="showTab('calls')">ðŸ“ž Aramalar</button>
    </div>

    <div class="main">
        <div class="header">
            <span id="roomTitle">Mesajlar</span>
            <div>
                <button onclick="clearMessages()">ðŸ—‘ Temizle</button>
            </div>
        </div>

        <div id="messagesTab" class="tab">
            <div class="messages" id="messages"></div>
            <div class="input-area">
                <input id="msgInput" placeholder="Mesaj yaz..." onkeydown="if(event.key==='Enter') sendMessage()">
                <button onclick="sendMessage()">GÃ¶nder</button>
            </div>
        </div>

        <div id="callsTab" class="tab" style="display:none;">
            <div class="messages">
                <input id="callTarget" placeholder="KullanÄ±cÄ± adÄ± gir">
                <button onclick="startCall()">Ara</button>
            </div>
        </div>
    </div>

    <script>
        const ws = new WebSocket("wss://mesaj-server.onrender.com");
        let username = prompt("KullanÄ±cÄ± adÄ±nÄ±z:");
        ws.onopen = () => {
            ws.send(JSON.stringify({ type: 'join', name: username }));
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'history') {
                data.messages.forEach(m => addMessage(m.name, m.text));
            }
            if (data.type === 'message') {
                addMessage(data.name, data.text);
            }
            if (data.type === 'cleared') {
                document.getElementById("messages").innerHTML = "";
            }
        };

        function addMessage(name, text) {
            const msgBox = document.getElementById("messages");
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `<strong>${name}:</strong> ${text}`;
            msgBox.appendChild(div);
            msgBox.scrollTop = msgBox.scrollHeight;
        }

        function sendMessage() {
            const text = document.getElementById("msgInput").value;
            if (!text) return;
            ws.send(JSON.stringify({ type: 'message', name: username, text }));
            document.getElementById("msgInput").value = "";
        }

        function clearMessages() {
            ws.send(JSON.stringify({ type: 'clear' }));
        }

        function showTab(tab) {
            document.getElementById("messagesTab").style.display = tab === 'messages' ? 'flex' : 'none';
            document.getElementById("callsTab").style.display = tab === 'calls' ? 'flex' : 'none';
            document.getElementById("roomTitle").textContent = tab === 'messages' ? 'Mesajlar' : 'Aramalar';
        }

        function startCall() {
            alert("Sesli arama Ã¶zelliÄŸi eklenecek.");
        }
    </script>
</body>
</html>

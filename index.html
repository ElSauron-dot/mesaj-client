<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MesajlaÅŸma UygulamasÄ±</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app">
    <header>
        <h1 id="roomTitle">Mesajlar</h1>
        <nav>
            <button id="tabMessages">Mesajlar</button>
            <button id="tabCalls">Aramalar</button>
        </nav>
        <button id="clearBtn">ðŸ—‘ TÃ¼m MesajlarÄ± Temizle</button>
    </header>

    <main id="messagesView">
        <div id="messages" class="messages"></div>
        <div class="input-area">
            <input type="text" id="nameInput" placeholder="AdÄ±nÄ±z">
            <input type="text" id="messageInput" placeholder="Mesaj yaz...">
            <button id="sendBtn">GÃ¶nder</button>
        </div>
    </main>

    <main id="callsView" style="display:none;">
        <h2>Sesli Kanallar</h2>
        <ul id="voiceChannelList"></ul>
        <input type="text" id="newChannelName" placeholder="Yeni kanal adÄ±">
        <button id="addChannelBtn">Sesli Sohbet Ekle</button>
    </main>
</div>

<script>
const serverUrl = "wss://mesaj-server.onrender.com"; // kendi Render URLâ€™in
const ws = new WebSocket(serverUrl);

// Sekmeler arasÄ± geÃ§iÅŸ
document.getElementById("tabMessages").onclick = () => {
    document.getElementById("messagesView").style.display = "block";
    document.getElementById("callsView").style.display = "none";
};
document.getElementById("tabCalls").onclick = () => {
    document.getElementById("messagesView").style.display = "none";
    document.getElementById("callsView").style.display = "block";
};

// Mesaj gÃ¶nderme
document.getElementById("sendBtn").onclick = () => {
    const name = document.getElementById("nameInput").value.trim();
    const text = document.getElementById("messageInput").value.trim();
    if (!name || !text) return;
    ws.send(JSON.stringify({ type: 'message', name, text }));
    document.getElementById("messageInput").value = "";
};

// MesajlarÄ± sadece kendi ekranÄ±nda temizleme
document.getElementById("clearBtn").onclick = () => {
    document.getElementById("messages").innerHTML = "";
};

// Sesli kanal ekleme
document.getElementById("addChannelBtn").onclick = () => {
    const channel = document.getElementById("newChannelName").value.trim();
    if (!channel) return;
    ws.send(JSON.stringify({ type: 'addVoiceChannel', channel }));
    document.getElementById("newChannelName").value = "";
};

// Sunucudan gelen veriler
ws.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.type === 'history') {
        document.getElementById("messages").innerHTML = "";
        data.messages.forEach(m => addMessage(m.name, m.text));
    }
    if (data.type === 'message') {
        addMessage(data.name, data.text);
    }
    if (data.type === 'voiceChannels') {
        const list = document.getElementById("voiceChannelList");
        list.innerHTML = "";
        data.channels.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c;
            list.appendChild(li);
        });
    }
};

function addMessage(name, text) {
    const div = document.createElement("div");
    div.className = "message";
    div.innerHTML = `<strong>${name}:</strong> ${text}`;
    document.getElementById("messages").appendChild(div);
    div.scrollIntoView();
}
</script>
</body>
</html>
